<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org"
    xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3">

<head>
    <title>Spring Security Example</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
        </script>
    <script th:inline="javascript">
        function getCurrentUser(user) {
            const myModal = document.getElementById("editModalCenter");
            myModal.addEventListener("shown.bs.modal", function (event) {
                const allInputs = myModal.querySelectorAll("input");
                for (let i = 1; i < allInputs.length; i++) {
                    const id = allInputs[i].getAttribute("id");
                    if (id.includes("ROLE")) {
                        allInputs[i].value = allInputs[i].id;
                    } else {
                        allInputs[i].value = user[id];
                    }
                }
            })
            const currForm = document.getElementById("editForm")
            currForm.setAttribute("action", "/admin/" + user.id + "/edit");
        }

        function deleteCurrentUser(user) {
            console.log(user);
            const myModal = document.getElementById("deleteModalCenter");
            myModal.addEventListener("shown.bs.modal", function (event) {
                const allInputs = myModal.querySelectorAll("input");
                for (let i = 1; i < allInputs.length; i++) {
                    const id = allInputs[i].getAttribute("id");
                    if (id.includes("ROLE")) {
                        allInputs[i].value = allInputs[i].id;
                    } else {
                        allInputs[i].value = user[id];
                    }
                }
            })
            const currForm = document.getElementById("deleteForm")
            currForm.setAttribute("action", "/admin/" + user.id + "/delete");
        }
    </script>
</head>

<body class="bg-light">
    <header th:replace="~{/fragments/header.html :: header}"></header>
    <main class="d-flex">
        <div th:replace="~{/fragments/sidebar.html :: sidebar}"></div>

        <th:block th:if="${#authorization.expression('hasRole(''ROLE_ADMIN'')')}">
            <div class="w-100 mx-3" th:insert="~{/pages/admin.html :: admin}" sec:authorize="hasRole('ROLE_ADMIN')">
            </div>
        </th:block>
        <th:block th:unless="${#authorization.expression('hasRole(''ROLE_ADMIN'')')}">
            <div class="w-100 mx-3" th:insert="~{/pages/user.html :: user}"></div>
        </th:block>
    </main>
</body>

</html>